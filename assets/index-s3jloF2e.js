(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"698d0731-ae53-4a36-a0c5-4c07e24b8856","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),Q=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(m),D=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(m),X=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(m),Y=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(m),Z=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(m),ee=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(m),te=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(m),oe=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");te(t,n).then(r=>{e.classList.toggle("card__like-button_is-active"),o.textContent=r.likes.length}).catch(r=>{console.log(r)})},re=e=>{e.remove()},N=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r)=>{const c=oe(),s=c.querySelector(".card__like-button"),i=c.querySelector(".card__control-button_type_delete"),_=c.querySelector(".card__image"),f=c.querySelector(".card__like-count");return _.src=e.link,_.alt=e.name,c.querySelector(".card__title").textContent=e.name,f.textContent=e.likes.length,e.likes.some(G=>G._id===r)&&s.classList.add("card__like-button_is-active"),o&&s.addEventListener("click",()=>o(s,e._id,f)),e.owner&&r&&e.owner._id!==r?i.remove():n&&i.addEventListener("click",()=>n(c,e._id)),t&&_.addEventListener("click",()=>t({name:e.name,link:e.link})),c},V=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},h=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",V)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",V)},ne=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})},ce=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},H=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},se=(e,t,o)=>{if(t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),!t.validity.valid){ce(e,t,t.validationMessage,o);return}H(e,t,o)},ae=e=>e.some(t=>!t.validity.valid),R=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ie=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},M=(e,t,o)=>{ae(e)?R(t,o):ie(t,o)},le=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);M(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{se(e,r,t),M(o,n,t)})})},E=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>H(e,r,t)),R(n,t)},ue=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>n.preventDefault()),le(o,e)})},b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},j=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),C=k.querySelector(".popup__form"),J=C.querySelector(".popup__input_type_name"),W=C.querySelector(".popup__input_type_description"),I=document.querySelector(".popup_type_new-card"),y=I.querySelector(".popup__form"),pe=y.querySelector(".popup__input_type_card-name"),de=y.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),T=B.querySelector(".popup__image"),me=B.querySelector(".popup__caption"),_e=document.querySelector(".profile__edit-button"),fe=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_edit-avatar"),S=A.querySelector(".popup__form"),ye=S.querySelector(".popup__input"),F=document.querySelector(".popup_type_remove-card"),he=F.querySelector(".popup__form"),l=document.querySelector(".popup_type_info"),p=l==null?void 0:l.querySelector(".popup__info"),L=l==null?void 0:l.querySelector(".popup__list"),U=document.querySelector(".header__logo");let g=null,q=null;const $=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),u=(e,t,o="Сохранить",n="Сохранение...")=>{e?t.textContent=n:t.textContent=o},z=({name:e,link:t})=>{T.src=t,T.alt=e,me.textContent=e,h(B)},ve=e=>{e.preventDefault();const t=e.submitter;u(!0,t),X({name:J.value,about:W.value}).then(o=>{w.textContent=o.name,P.textContent=o.about,d(k)}).catch(o=>{console.log(o)}).finally(()=>{u(!1,t)})},Se=e=>{e.preventDefault();const t=e.submitter;u(!0,t),Y(ye.value).then(o=>{x.style.backgroundImage=`url(${o.avatar})`,S.reset(),d(A)}).catch(o=>{console.log(o)}).finally(()=>{u(!1,t)})},be=e=>{e.preventDefault();const t=e.submitter;u(!0,t,"Создать","Создание..."),Z({name:pe.value,link:de.value}).then(o=>{j.prepend(N(o,{onPreviewPicture:z,onLikeIcon:O,onDeleteCard:K},o.owner._id)),y.reset(),d(I)}).catch(o=>{console.log(o)}).finally(()=>{u(!1,t,"Создать")})},Ce=e=>{if(e.preventDefault(),g&&q){const t=e.submitter;u(!0,t,"Да","Удаление..."),ee(q).then(()=>{re(g),d(F)}).catch(o=>{console.log(o)}).finally(()=>{u(!1,t,"Да")})}},K=(e,t)=>{g=e,q=t,h(F)},v=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=String(t),n},Le=()=>{D().then(e=>{if(!l||!p||!L)return;p.innerHTML="",L.innerHTML="";const t=new Map;e.forEach(s=>{if(s.owner&&s.owner._id){const i=s.owner._id,_=s.owner.name||"—",f=t.get(i)||{name:_,count:0};f.count+=1,f.name=_,t.set(i,f)}});const o=e.length,n=o?new Date(e[o-1].createdAt):null,r=o?new Date(e[0].createdAt):null;let c=0;t.forEach(({count:s})=>{s>c&&(c=s)}),p.append(v("Всего карточек:",o)),n&&p.append(v("Первая создана:",$(n))),r&&p.append(v("Последняя создана:",$(r))),p.append(v("Всего пользователей:",t.size)),p.append(v("Максимум карточек от одного:",c)),Array.from(t.values()).map(s=>s.name).forEach(s=>{const i=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);i.textContent=s,L.append(i)}),h(l)}).catch(e=>{console.log(e)})};C.addEventListener("submit",ve);y.addEventListener("submit",be);S.addEventListener("submit",Se);he.addEventListener("submit",Ce);_e.addEventListener("click",()=>{J.value=w.textContent,W.value=P.textContent,E(C,b),h(k)});x.addEventListener("click",()=>{S.reset(),E(S,b),h(A)});fe.addEventListener("click",()=>{y.reset(),E(y,b),h(I)});U&&U.addEventListener("click",Le);ue(b);const ge=document.querySelectorAll(".popup");ge.forEach(e=>{ne(e)});Promise.all([D(),Q()]).then(([e,t])=>{w.textContent=t.name,P.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{j.append(N(o,{onPreviewPicture:z,onLikeIcon:O,onDeleteCard:K},t._id))})}).catch(e=>{console.log(e)});
